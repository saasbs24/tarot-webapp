<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Выбор карт Таро</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        h1 {
            color: #333;
        }
        #cards {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .card {
            width: 120px;
            height: 200px;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
            transform-origin: center;
            animation: spin 6s linear infinite;
        }
        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .selected-cards {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>🎯 Выберите 3 карты Таро</h1>
    <div id="cards"></div>
    <div id="selectedCards" class="selected-cards"></div>
    <button id="submitBtn" disabled>✅ Отправить выбранные карты</button>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const tg = window.Telegram.WebApp;
            tg.expand();
            
            const params = new URLSearchParams(window.location.search);
            let user_id = params.get("user_id") || (tg.initDataUnsafe?.user?.id || null);

            if (!user_id) {
                console.error("❌ Ошибка: user_id не получен!");
                alert("Ошибка: WebApp не смог получить ваш user_id!");
                return;
            }

            const allCards = [
				"Шут.jpg", "Маг.jpg", "Верховная жрица.jpg", "Императрица.jpg", "Император.jpg", "Иерофант.jpg", 
				"Влюбленные.jpg", "Колесница.jpg", "Сила.jpg", "Отшельник.jpg", "Колесо фортуны.jpg", "Справедливость.jpg",
				"Повешенный.jpg", "Смерть.jpg", "Умеренность.jpg", "Дьявол.jpg", "Башня.jpg", "Звезда.jpg", 
				"Луна.jpg", "Солнце.jpg", "Суд.jpg", "Мир.jpg",
				"Туз жезлов.jpg", "Двойка жезлов.jpg", "Тройка жезлов.jpg", "Четверка жезлов.jpg", "Пятерка жезлов.jpg",
				"Шестерка жезлов.jpg", "Семерка жезлов.jpg", "Восьмерка жезлов.jpg", "Девятка жезлов.jpg", "Десятка жезлов.jpg",
				"Паж жезлов.jpg", "Рыцарь жезлов.jpg", "Королева жезлов.jpg", "Король жезлов.jpg",
				"Туз кубков.jpg", "Двойка кубков.jpg", "Тройка кубков.jpg", "Четверка кубков.jpg", "Пятерка кубков.jpg",
				"Шестерка кубков.jpg", "Семерка кубков.jpg", "Восьмерка кубков.jpg", "Девятка кубков.jpg", "Десятка кубков.jpg",
				"Паж кубков.jpg", "Рыцарь кубков.jpg", "Королева кубков.jpg", "Король кубков.jpg",
				"Туз мечей.jpg", "Двойка мечей.jpg", "Тройка мечей.jpg", "Четверка мечей.jpg", "Пятерка мечей.jpg",
				"Шестерка мечей.jpg", "Семерка мечей.jpg", "Восьмерка мечей.jpg", "Девятка мечей.jpg", "Десятка мечей.jpg",
				"Паж мечей.jpg", "Рыцарь мечей.jpg", "Королева мечей.jpg", "Король мечей.jpg",
				"Туз пентаклей.jpg", "Двойка пентаклей.jpg", "Тройка пентаклей.jpg", "Четверка пентаклей.jpg", "Пятерка пентаклей.jpg",
				"Шестерка пентаклей.jpg", "Семерка пентаклей.jpg", "Восьмерка пентаклей.jpg", "Девятка пентаклей.jpg", "Десятка пентаклей.jpg",
				"Паж пентаклей.jpg", "Рыцарь пентаклей.jpg", "Королева пентаклей.jpg", "Король пентаклей.jpg"
			];
            
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            const availableCards = shuffle([...allCards]).slice(0, 5);
            const cardsContainer = document.getElementById("cards");
            const selectedCardsContainer = document.getElementById("selectedCards");
            let selected = [];

            availableCards.forEach(card => {
                const cardElement = document.createElement("div");
                cardElement.className = "card";
                cardElement.innerHTML = `<img src="cards/${card}" alt="${card}">`;
                cardElement.addEventListener("click", function () {
                    if (selected.length < 3 && !selected.includes(card)) {
                        selected.push(card);
                        cardElement.classList.add("selected");
                    }
                    if (selected.length === 3) {
                        finalizeSelection();
                    }
                });
                cardsContainer.appendChild(cardElement);
            });

            function finalizeSelection() {
                cardsContainer.innerHTML = "";
                selectedCardsContainer.innerHTML = "";
                selected.forEach(card => {
                    const selectedCard = document.createElement("div");
                    selectedCard.className = "card";
                    selectedCard.innerHTML = `<img src="cards/${card}" alt="${card}">`;
                    selectedCardsContainer.appendChild(selectedCard);
                });
                document.getElementById("submitBtn").disabled = false;
            }
            
            document.getElementById("submitBtn").addEventListener("click", () => {
                if (selected.length === 3) {
                    console.log("📤 Отправка данных в Telegram:", selected);
                    const payload = JSON.stringify({ user_id, cards: selected });
                    tg.sendData(payload);
                    setTimeout(() => {
                        tg.close();
                    }, 1000);
                }
            });
        });
    </script>
</body>
</html>

